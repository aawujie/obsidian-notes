
> "两步法线性截面回归"（Two-Pass Cross-Sectional Regression）
> 实证资产定价的"**工业标准**"，量化研究员面试必考。

[B站参考视频](https://www.bilibili.com/video/BV1Py4y1j7x5/?spm_id_from=333.337.search-card.all.click&vd_source=fdf204514e682cfd0d820e88a84bbe31) | [配套 Notebook：10.fama_macbeth.ipynb](../../../code/1.econometric/Time-Series-and-Financial-Engineering-With-Python/notebooks/base_knowledge/10.fama_macbeth.ipynb)

---

## 1. 核心定位：因子的"终极定价裁判"

Fama-MacBeth 回归（1973）解决一个核心问题：**某种特征（如市值、动量）是否真的对应着长期的风险溢价（$\lambda$）？**

它的伟大之处：巧妙解决了金融数据中"残差在截面上相关"的问题——能判定你赚的钱是真的风险补偿，还是仅仅因为这个月刚好大家都在涨。

---

## 2. 为什么需要 FMB？

### OLS 的局限

OLS（普通最小二乘线性回归）：用一条直线去拟合散点图，使所有点到直线的"垂直距离平方和"最小。

$$
\text{下月收益} = \alpha + \beta \times \text{市值} + \varepsilon
$$

$\beta$ 就是我们最关心的"斜率"（市值每变 1，收益变多少）。

### 股票数据的两大毒瘤

- **截面相关**：同一个月，所有股票的残差几乎同方向（市场因子、行业因子等）
- **时间序列相关**：同一只股票不同月份残差也相关

普通 pooled OLS、固定效应、甚至单向聚类都会**严重低估标准误** → t 值爆炸 → 假显著。

### FMB 的解法

**先每月做截面回归 → 把共同冲击压缩进当月系数 → 最后只用"时间序列"算标准误**

等价于"按时间聚类"的标准误差，但更直观、更容易加控制变量。

---

## 3. 数据的「形状」：先看清再下刀

在开始三步走之前，先理解你手里的数据长什么样。

下面这张热力图展示了 **100 只股票 × 120 个月** 的收益率矩阵：

![[fmb_heatmap.png]]

> - **沿行切（→）**= Step 1 时序回归：一只股票的 120 个月历史
> - **沿列切（↓）**= Step 2 截面回归：一个月里 100 只股票的排位

所有股票共享同一条**公共因子** $f_t$（比如市场超额收益）：

![[fmb_factor_ts.png]]

---

## 4. 三步走流程（图解版）

假设 $N$ 只股票，$K$ 个待检验因子，时间跨度 $T$ 个月。

### Step 1：时间序列回归 —— 「量体裁衣」（估算 $\beta$）

**目标**：确定每只股票对因子的敏感度。

- **动作**：对每一只股票，用它过去 60 个月（<span style="color:rgb(255, 77, 77)">滚动窗口，最少 36 个月</span>）的收益率对**公共因子**收益率做回归
- **公式**：$R_{i,t} = \alpha_i + \beta_i f_t + \varepsilon_{i,t}$
- **产出**：<span style="color:rgb(255, 77, 77)">每只股票的风险暴露 $\hat{\beta}_{i}$</span>
- **跑几次**：$N$ 次（每只股票一次）

每只股票的散点图里，**<span style="color:rgb(255, 77, 77)">斜率就是 Beta**</span>：

![[fmb_step1_scatter.png]]

估计得准不准？100 只股票的 $\hat{\beta}$ 与真实 $\beta$ 高度吻合（相关系数 > 0.98）：

![[fmb_step1_beta_qc.png]]

### Step 2：横截面回归 —— 「月度发奖金」（估算 $\lambda$）

**目标**：这个月里，拥有某种 "标签" 的股票多赚了多少钱。

- **动作**：在<span style="color:rgb(255, 77, 77)">每一个时间点 $t$</span>（每个月），把<span style="color:rgb(255, 77, 77)">所有股票放在一起</span>，<span style="color:rgb(255, 77, 77)">用当月实际收益率对上一步的 $\hat{\beta}$ 做回归</span>
- **公式**：$R_{i,t} = \gamma_{0,t} + \lambda_t \hat{\beta}_{i} + \eta_{i,t}$
- **产出**：<span style="color:rgb(255, 77, 77)">因子收益率</span>的时间序列 $\hat{\lambda}_1, \hat{\lambda}_2, \dots, \hat{\lambda}_T$（每个月市场发的 "<span style="color:rgb(255, 77, 77)">临时奖金</span>"）
- **跑几次**：$T$ 次（<span style="color:rgb(255, 77, 77)">每月一次</span>）

不同月份的截面长这样——有的月份 Beta 高真的赚得多（正斜率），有的月反转（负斜率）：

![[fmb_step2_monthly.png]]

把 120 条截面拟合线叠在一起，形成一个**扇形**。<span style="color:rgb(255, 77, 77)">红色粗线 = 平均 $\bar{\lambda}$</span>：

![[fmb_step2_fan.png]]

> 绿线 = 正溢价月（因子有效），橙线 = 负溢价月（因子反转），<span style="color:rgb(255, 77, 77)">看红线是否稳定偏正</span>。

### Step 3：时序平均与 $t$ 检验 —— 「算总账」

**目标**：<span style="color:rgb(255, 77, 77)">判定奖金是否显著且稳定</span>。

- 最终因子溢价：$\bar{\lambda} = \frac{1}{T} \sum \lambda_t$
- Fama-MacBeth 标准误：$SE_{FM} = \frac{\text{std}(\lambda_1, \lambda_2, \dots, \lambda_T)}{\sqrt{T}}$
- $t$ 统计量：$t = \frac{\bar{\lambda}}{SE_{FM}}$

> 直觉：120 个 $\lambda$ 自己跳来跳去的幅度，除以 $\sqrt{120}$。因为看了 120 个月，信息量多了 $\sqrt{120}$ 倍。

左图看月度波动，右图看分布是否偏离零：

![[fmb_step3_lambda.png]]

把 t 值标在 t 分布上，一眼看出显著性：

![[fmb_step3_ttest.png]]

---

## 5. 三步走流程速查

```
原始数据:  收益率矩阵 R (N×T) + 公共因子 f_t (T×1)

Step 1 ── 时序回归（纵向切，跑 N 次）
  每只股票 vs 同一条 f_t 做回归
  ➜ 输出: N 个 β̂（敏感度标签）

Step 2 ── 截面回归（横向切，跑 T 次）
  每月拿所有股票的收益 vs β̂ 做回归
  ➜ 输出: T 个 λ_t（月度风险溢价）

Step 3 ── 汇总（取平均 + t 检验）
  λ̄ = mean(λ_t),  t = λ̄ / SE(λ̄)
  ➜ 输出: 因子值不值钱的最终判决
```

| 维度      | Step 1 (时序)                                                 | Step 2 (截面)                                             | Step 3 (汇总)                                                      |
| ------- | ----------------------------------------------------------- | ------------------------------------------------------- | ---------------------------------------------------------------- |
| **方向**  | 纵向（沿行）                                                      | 横向（沿列）                                                  | 纵向（沿时间）                                                          |
| **跑几次** | N 次                                                         | T 次                                                     | 1 次                                                              |
| **X 轴** | 公共因子 $f_t$                                                  | $\hat{\beta}_i$                                         | —                                                                |
| **Y 轴** | 个股收益 $r_{i,t}$                                              | 个股收益 $r_{i,t}$                                          | —                                                                |
| **输出**  | <span style="color:rgb(255, 77, 77)">$\hat{\beta}_i$</span> | <span style="color:rgb(255, 77, 77)">$\lambda_t$</span> | <span style="color:rgb(255, 77, 77)">$\bar{\lambda}$, t 值</span> |
| **比喻**  | 量体裁衣                                                        | 月度发奖金                                                   | 算总账                                                              |

---

## 6. 标准模型（完整公式）

$$
r_{i,t+1} = \lambda_t + \gamma_t f_{i,t} + \beta_t Size_{i,t} + \sum \gamma_{j,t} Industry_{j,i,t} + \varepsilon_{i,t+1}
$$

翻译成人话：**下月收益 = 当月底薪 + 特征奖励 + 市值惩罚/奖励 + 行业奖励 + 运气**

### 各变量解释

| 符号 | 含义 | 说明 |
|------|------|------|
| $r_{i,t+1}$ | 股票 i 在 t+1 月的超额收益率 | |
| $\lambda_t$ | 当月截距（底薪） | |
| $\gamma_t$ | 因子收益率（奖励力度） | 核心！就是我们要估的"风险价格" |
| $f_{i,t}$ | 你关心的特征 | Size, Value, Momentum, Turnover, Illiquidity, Beta, Skewness… |
| $\beta_t$ | 当月市值效应的斜率 | >0 大盘吃香；<0 小盘吃香；≈0 不重要 |
| $Size_{i,t}$ | ln(流通市值) 或 ln(总市值) | |
| $Industry_{j,i,t}$ | 行业哑变量（0/1 开关） | 只有属于该行业才 = 1 |
| $\gamma_{j,t}$ | 行业 j 当月的额外收益 | 银行股集体狂飙时为正 |
| $\varepsilon_{i,t+1}$ | 残差（运气） | 永远存在，平均为 0，不能消除 |

### Q&A

**A股小市值效应**：实际 A 股样本里，$\beta_t$ 几乎每个月都是负的（平均 -0.3% ~ -0.8%），意味着每个月小股票平均比大股票表现好 0.3%~0.8%。

**什么是哑变量？** 0/1 开关，只有属于这个行业的股票才打开开关，吃到该行业的额外收益：

| 股票 | 是银行 | 是地产 | 是白酒 | 是光伏 | 是科技 |
|------|--------|--------|--------|--------|--------|
| 招商银行 | 1 | 0 | 0 | 0 | 0 |
| 万科 | 0 | 1 | 0 | 0 | 0 |
| 茅台 | 0 | 0 | 1 | 0 | 0 |
| 隆基 | 0 | 0 | 0 | 1 | 0 |
| 宁德时代 | 0 | 0 | 0 | 0 | 1 |

**风险价格（Price of Risk）**：$\gamma_t$ 是当月市场为扛一单位风险实际付的钱。把所有月份取平均 $\bar{\gamma}$，就是教科书里的"风险的价格"。

---

## 7. FMB vs 普通截面回归（Two-pass）

这是书中最易混淆的考点，区别在于"先取平均"还是"后取平均"：

| 方法               | 做法                                       | 优劣                                                                         |
| ---------------- | ---------------------------------------- | -------------------------------------------------------------------------- |
| **普通截面回归**       | 先算每只股票 10 年的**平均收益**，拿平均收益只做 **1 次**截面回归 | 静态，<span style="color:rgb(255, 77, 77)">忽略了 $\beta$ 随时间变化</span>           |
| **Fama-MacBeth** | 每个月都做 1 次截面回归，共 $T$ 次，最后对结果取平均           | <span style="color:rgb(255, 77, 77)">动态</span>，允许股票这个月是小盘、下个月涨成中盘，依然准确捕捉溢价 |

---

## 8. 两个必打的补丁

### 补丁一：Shanken 修正

回归用的 $\beta$ 是估算出来的，带有测量误差（EIV 问题）。必须对最终标准误进行缩放，否则 $t$ 值虚高，垃圾因子被误判为宝贝。

### 补丁二：Newey-West 调整

第三步算总账时，因子收益率在时间上可能有惯性（自相关）。必须用 Newey-West 重新计算标准误，确保 $t$ 值诚实。

---

## 9. 常见变种

| 版本 | 第一步 beta | 第二步被解释变量 | 适用场景 |
|------|-------------|------------------|----------|
| 经典 FM (1973) | 全样本 | 当月回报 | 早期研究 |
| 滚动 FM（主流） | 过去 36–60 月滚动估计 | 当月回报 | 目前 99% 论文 |
| Fama-French (1992) | 全样本 | 当月回报 | 构造因子时常用 |
| Portfolio-level FM | 25/49 组合排序后跑 | 组合当月回报 | 减少 EIV 偏差 |

---

## 10. t 统计量速查

| 写法          | 例子                 | 常见场景          |
| ----------- | ------------------ | ------------- |
| t-stat      | t-stat = 3.28      | 顶刊最常见（JF、JFE） |
| t-value     | t-value = 3.28     | 稍微正式          |
| t-statistic | t-statistic = 3.28 | 教科书标准写法       |
| t           | (3.28)             | 表格里最省地方       |

**显著性门槛**：

- |t| > 1.96 → 5% 水平显著（勉强及格）
- |t| > 2.58 → 1% 水平显著（国内顶刊最低要求）
- |t| > 3.00 → 顶刊真正开始心动
- |t| > 5.00 → 直接 JF/RFS 一作

一句话：**t-stat = 平均收益 ÷ 最诚实的标准误（$SE_{FM}$）**

---

## 11. 手算示例

| 月 | 股票 | 下月收益 | 特征 f | ln市值 | 行业 |
|----|------|----------|--------|--------|------|
| 1 | A | 0.05 | 0.30 | 7.2 | 银行 |
| 1 | B | 0.03 | 0.15 | 6.8 | 银行 |
| 1 | C | -0.01 | -0.20 | 5.5 | 制造 |
| 2 | A | 0.08 | 0.35 | 7.3 | 银行 |
| … | … | … | … | … | … |

每月回归后得到 $\gamma_t$（特征 f 的系数）：

- 月1：$\gamma_1 = 0.112$
- 月2：$\gamma_2 = 0.138$
- 月3：$\gamma_3 = 0.095$

$$\bar{\gamma} = \frac{0.112 + 0.138 + 0.095}{3} = 0.115$$

$$std(\gamma_t) \approx 0.022$$

$$SE_{FM} = \frac{0.022}{\sqrt{3}} \approx 0.0127$$

$$t = \frac{0.115}{0.0127} \approx 9.05$$

结论：每月平均多赚 1.15%，t 值 9.05，极度显著。

---

## 12. 形象比喻：月度短跑联赛

1. **第一步**：给每个选手量腿长，观察他平时的跑步习惯（算出 $\beta$）
2. **第二步**：联赛每月比一次。在这个月里，对比所有选手的速度，算出"步幅每增加 1 厘米，速度能快多少"（算月度 $\lambda_t$）
3. **第三步**：联赛比了 10 年，把 120 个月的结论取平均。如果步幅大的选手**平均**确实跑得快且表现稳定 → 宣布"步幅"是一个有效的致胜因子！

---

## 记忆口诀

> **"Fama-MacBeth 先纵后横再汇总。"**
> 1. **先纵**：沿时间轴给每只股票贴 Beta 标签（量体裁衣）
> 2. **后横**：每个月横着切一刀，看 Beta 标签值多少钱（月度发奖金）
> 3. **再汇总**：沿时间轴纵向平均，看这笔钱领得稳不稳定（算总账）
