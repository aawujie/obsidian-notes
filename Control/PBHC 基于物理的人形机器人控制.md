## 📖 前言：G 1 为什么能打功夫？

最近宇树 G 1 机器人展示了惊人的动态运动能力——从挥拳、踢腿到复杂的功夫动作。这一切的幕后推手并非传统的示教编程，而是一套名为 **PBHC** 的先进控制框架。

**PBHC** 全称 **Physics-Based Humanoid Control**（基于物理的人形机器人控制）。

它是论文 **《KungfuBot: Physics-Based Humanoid Whole-Body Control for Learning Highly-Dynamic Skills》** 的核心实现。

> 🔗 **开源项目地址：** [https://github.com/TeleHuman/PBHC](https://github.com/TeleHuman/PBHC)

---

## 1. 核心流程图 (Pipeline)

![[Pasted image 20260217021850.png]]

该项目的实现遵循一个经典的 “动作捕捉 -> 物理修正 -> 强化学习训练 -> 真机部署” 的路径：

1.  **视频输入** (Human Video) $\to$ **姿态估计** (Pose Estimation)
2.  **动作重定向** (Motion Retargeting) $\to$ **初步机器人动作**
3.  **物理过滤/参考生成** (Physics-based Reference Generation) $\to$ **物理可行轨迹**
4.  **强化学习训练** (RL Training in Isaac Gym) $\to$ **控制策略 (Policy)**
5.  **真机推理** (Real-world Deployment)

---

## 2. 详细步骤拆解

### 第一步：动作重定向 (Motion Retargeting)

由于人类的骨骼比例与 Unitree G 1 完全不同（例如人的大腿长、机器人的小腿长），直接把人的关节角度给机器人会导致它重心不稳或关节打架。
*   **实现方式：** 项目使用了**逆运动学 (IK)**。
*   **原理：** 它不是简单地复制角度，而是优先保证关键点（如手掌、脚踝、骨盆）在空间中的相对位置一致，通过优化算法解出最适合 G 1 硬件的关节角度序列。

### 第二步：基于物理的参考运动生成 (**Physics-Based Reference**)

这是 PBHC 命名的由来。单纯的 IK 动作在物理上往往是不可行的（比如人在视频里跳跃，但机器人可能因为太重跳不起来）。

*   **核心逻辑：** 系统在仿真中运行一个初步的控制器来 “追” 这个 IK 动作。
*   **作用：** 如果某个动作会导致机器人失去平衡，物理引擎会对其进行“平滑”和“修正”。最终生成一套**既像人、又符合物理规律（不会摔倒、扭矩不超限）** 的参考轨迹。

### 第三步：强化学习与奖励函数设计 (RL & Reward Design)

这是项目最硬核的部分。在 NVIDIA Isaac Gym 中，成千上万个 G1 机器人同时练习这些动作。

*   **状态空间 (Observation):** 机器人感知到的自身状态（关节角度、速度、IMU 姿态、上一步的动作值）以及**未来的参考动作**（告诉机器人下一秒要踢腿了）。
*   **动作空间 (Action):** 23 个或更多关节的 PD 控制器目标角度。
*   **奖励函数 (Reward Function) - 成功的关键：**
    *   **姿态奖励 ($r_p$):** 当前关节角度与参考动作越像，分越高。
    *   **速度奖励 ($r_v$):** 关节旋转速度与参考动作匹配。
    *   **末端位置奖励 ($r_{ee}$):** 手和脚的位置要对准。
    *   **根节点奖励 ($r_{root}$):** 躯干的高度和朝向要正确。
    *   **生存奖励/平滑奖励:** 别摔倒，动作别抖动。

### 第四步：Sim-to-Real 的鲁棒性增强

为了让 G 1 在现实中也能打出功夫，而不只是在电脑里，项目加入了：
*   **域随机化 (Domain Randomization):** 在仿真里随机改变地面摩擦力、机器人的质量分布、电机的强度。
*   **扰动训练:** 在训练时给机器人施加随机的外力，强迫它学会 “在被打扰时也能完成动作”。

---

## 3. 项目代码结构关键点 (以 GitHub 为准)

如果你去翻看其代码库，你会发现几个关键文件夹：

* **`cfg/` (配置):** 定义了机器人的物理参数、强化学习的奖励权重。
* **`tasks/`:** 核心逻辑所在。你会看到 `g1_kungfu.py` 之类的文件，里面定义了如何读取人类动作数据（通常是 `.npy` 或 `.pkl` 文件）。
* **`scripts/`:** 
	*   `train.py`: 启动 Isaac Gym 进行并行训练。
    *   `play.py`: 加载训练好的 `.pt` 权重文件，观察训练效果。

---

## 4. 为什么这个项目比普通控制厉害？

1.  **克服了“高动态”难题：** 传统的平衡算法（如 MPC）通常假设脚一直踩在地上。而功夫动作中有大量腾空、单脚旋转，PBHC 通过强化学习探索出了在极限状态下利用惯性保持平衡的方法。
2.  **端到端模仿：** 它不需要工程师手写“如何踢腿”的代码，只需要提供“人踢腿”的视频。这极大降低了人形机器人学习新技能的门槛。
3.  **针对 G1 优化：** 该项目是目前开源社区中针对宇树 G 1 适配得最好的动态动作库之一，充分发挥了 G1 电机高响应的特点。

## 总结

`TeleHuman/PBHC` 是一个典型的**具身智能 (Embodied AI)** 项目。它把人类的“视觉经验”转化成了机器人的“肌肉记忆”。对于宇树 G 1 的开发者来说，这个库是研究**非平稳运动控制**的最佳教科书。