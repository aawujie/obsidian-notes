---
notion-id: 30278d23-e296-80c9-8fcd-f0af7d478c1a
base: "[[因子投资.base]]"
Last edited time: 2026-02-11T18:43:00
Tags: []
Verification: unverified
Owner:
  - 杰 吴
---
---

## 1. 它是做什么的？

Ljung-Box 检验的主要目的是：**检测一段数据是否为 “白噪声”（纯随机序列）**。

- **如果是白噪声**：说明数据完全随机，没有任何规律可循。
- **如果不是白噪声**：说明数据里面还藏着 “规律”（自相关性），你可以通过建模把这些规律挖出来。

## 2. 它的核心原理：集体审查

之前我们学的 **ACF 图 是 “单对单” 检查**：看今天和昨天有没有关系，看今天和前天有没有关系。

**Ljung-Box 检验** 是 “集体审查”：

- 它不是只看某一天，而是**把过去 m 天（一个滞后窗口）的自相关性全部打包加总，算出一个综合得分（Q 统计量）。**
- **原理**：**如果过去很多天的自相关性累积起来很高，那么这段序列就不可能是随机的**。

## 3. 两个关键的使用场景（重点！）

在量化建模中，LB 检验通常出现在两个阶段，但我们的**期望结果截然不同**：

### 场景 A：建模前（检测原始数据）

- **目的**：**确认这组数据值不值得建模。**
- **期望**：**拒绝原假设（P < 0.05）。**
- **含义**：数据不是白噪声，里面有规律，我们可以上 ARMA 模型！

### 场景 B：建模后（检测模型残差）

- **目的**：**检查模型是否把规律 “榨干” 了。**
- **期望**：**接受原假设（P > 0.05）。**
- **含义**：剩下的残差已经全是纯随机的白噪声了。说明模型很完美，没有漏掉任何规律。

## 4. 数学公式

### **4.1 核心假设（Hypothesis）**

LB 检验属于**总体检验**。它不是只看某一个滞后阶数，而是看前 m 阶的“整体表现”。

- **原假设 (**$H_0$**)**：$ρ1=ρ2=⋯=ρm=0$（前 m 个自相关系数全是 0，即：**数据是白噪声**）
- **备择假设 (**$H_a$**)**：至少存在一个 $ρk≠0$（前 m 个里至少有一个是有规律的，即：**数据不是白噪声**）

### **4.2 核心公式：Q 统计量**

LB 检验通过计算一个 **Q 统计量** 来打分。公式如下：

$$
Q = n(n+2) \sum\limits_{k=1}^{m} \frac{\hat{\rho}_{k}^2}{n - k}
$$

**公式拆解：**

- $n$：样本总量（数据点有多少个）。
- $m$：你要检查的滞后阶数（比如检查过去 10 天的集体表现）。
- $\hat{\rho}_{k}^2$：序列在滞后 k 阶时的**自相关系数的平方**。
    - *为什么平方？* 因为我们不在乎是正相关还是负相关，我们要看的是**相关的强度**。
- $n(n+2)$** 和 **$n−k$：这是 LB 检验对老版 Box-Pierce 检验的修正。
    - 在样本量 $n$ 比较小的时候，这个修正能让结果更精确，防止误判。

**直观理解公式**：

这个 Q 值，其实就是**把前 m 个自相关系数的平方，按照一定的权重加总**。如果每一阶的自相关都很小，Q 就会很小；只要有一阶特别大，Q 就会迅速飙升。

### 4.3 判定标准：卡方分布 ($χ2$)

[[卡方分布（Chi-Square Distribution）]] 

在原假设（白噪声）成立的情况下，$Q$ 统计量服从**卡方分布**：

$$
Q∼χ2(df)
$$

**关键：自由度 (**$df$**) 怎么定？**

这是实战中最容易错的地方，分两种情况：

1. **直接测原始数据（如收益率）**：
自由度 $df=m$ （你测了多少阶，自由度就是多少）。
2. **测 ARMA 模型的残差**：
自由度 $df=m−p−q$。
    - $p$ 和 $q$ 是 ARMA 模型的阶数。
    - 原理：因为残差是经过模型提取后的产物，你损失了 $p + q$  个自由度。**如果不减去这两个数，你的 P 值会偏大，导致你错误地认为模型洗干净了。**

### 4.4 **判定结论**

- **Q 值很大 →  P 值很小 (<0.05)**：
落在卡方分布的拒绝域。结论：**拒绝原假设**，说明数据里有规律（不是白噪声）。
- **Q 值很小  →  P 值很大 (>0.05)**：落在接受域。
结论：**不能拒绝原假设**，说明数据很随机（是白噪声）。

## 5. 假设检验的逻辑

- **原假设 (**$H_0$**)**：序列是白噪声（独立随机，没规律）。
- **备择假设 (**$H_a$**)**：序列不是白噪声（有规律）。

| 结果 | P值 | 结论 | 备注 |
| --- | --- | --- | --- |
| **显著** | **P < 0.05** | **拒绝原假设** | 有规律，不是白噪声。 |
| **不显著** | **P > 0.05** | **接受原假设** | 没规律，是白噪声。 |

## 6. 为什么它比看 ACF 图更科学？

- **ACF 图**：是 “单兵作战”。如果你看了 20 阶，其中只有第 7 阶稍微露头了一点点，你很难判断这是  “真规律” 还是 “偶然的噪音”。
- **LB 检验**：是 “集团作战”。**它把这 20 阶所有的能量聚在一起。如果第 7 阶的那个头露得足够高，或者好几阶都隐约有点高，Q 统计量就会报警**。它能捕捉到那些**单阶不明显但整体有偏离**的趋势。

## 7. Notebook 代码实现

```python
from statsmodels.stats.diagnostic import acorr_ljungbox

# 对残差进行 LB 检验，查看前 10 个滞后项
res = acorr_ljungbox(residuals, lags=[10], return_df=True)

print(res)

# 核心看 lb_pvalue
if res['lb_pvalue'].values[0] > 0.05:
    print("验收通过：残差是白噪声，模型已提取所有规律。")
else:
    print("验收失败：残差仍有自相关性，模型需要改进。")
```
