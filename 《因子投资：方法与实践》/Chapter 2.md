这部分内容被作者称为因子研究的“一切的基础”，是量化研究员必须掌握的核心技能。

---

# 第一节：投资组合排序法 (Portfolio Sort)

## 1. 核心逻辑：解决“先有鸡还是先有蛋”的问题

在研究因子时，我们面临一个矛盾：

* 要计算**因子暴露（Beta）**，需要知道**因子收益率**。
* 要计算**因子收益率**，通常需要知道资产的**因子暴露**。

**排序法的精髓**：它绕过了“因子暴露已知”这个前提。它假设**排序变量（如 BM、市值）与因子暴露是正相关的**。通过变量的高低来代替暴露的高低，从而构建出因子模拟组合。

---

## 2. 因子模拟投资组合 (Factor Mimicking Portfolio)

构建一个理想的因子模拟组合需要满足两个条件：

1.  **条件一**：仅在目标因子上有大于零的暴露，在其他因子上暴露为零。
2.  **条件二**：在满足条件一的基础上，组合的**特质性风险（Idiosyncratic Risk）最小**。

---

## 3. 标准排序法的四个步骤

排序法（Portfolio Sort）通常包含以下具体操作流程：

### (1) 排序 (Sorting)

*   **确定股票池**：剔除 ST、停牌、新股等。
*   **按指标排序**：在每个截面上（如每个月末），按照排序变量（如账面市值比 BM）对所有股票从大到小（或从小到大）排列。

### (2) 分组 (Grouping)

*   **分桶**：通常按照十分位数（Deciles）将股票分为 $L$ 组（常用 $L=10$）。
*   **构建价差组合（Spread Portfolio）**：
    *   **多头**：买入指标最强的一组（如高 BM 组）。
    *   **空头**：卖出指标最弱的一组（如低 BM 组）。
    *   **结果**：该对冲组合的收益率即被视为该因子的收益率 $\lambda$。

### (3) 加权 (Weighting)

* 在每个组内部，确定个股权重。常见方式：
    *   **等权重 (Equal Weight, EW)**。
    *   **市值加权 (Value Weight, VW)**：更符合大资金实战，且能降低小市值股票异象的干扰。

### (4) 定期更新 (Rebalance)

* 因为股票的指标（如价格、财务数据）会变，必须定期（每月或每年）重新排序、分组、换仓，从而产生**因子收益率的时间序列**。

---

## 4. 因子有效性检验：数学公式详解

数学公式虽然不多，但它们构成了定量评估因子的**核心标尺**。

排序法的公式主要解决两个问题：

1. **因子收益稳不稳定（t 检验）？**
2. **因子逻辑顺不顺（单调性检验）？**

---

### (1) 因子预期收益率的估计 ($\hat{\lambda}$)

通过排序法，我们每个月（或每期）都会得到一个因子收益率 $\lambda_t$（通常是第一组收益减去最后一组收益）。

**公式 (2.1)：**
$$\hat{\lambda} = \frac{1}{T} \sum_{t=1}^{T} \lambda_t$$

*   **符号含义：**
    *   $\lambda_t$：$t$ 时刻（比如某个月）因子模拟组合的实际收益率。
    *   $T$：总期数（回测了多少个月）。
    *   $\hat{\lambda}$：因子收益率的**样本均值**，即我们对该因子未来预期收益率的估计。
*   **深度讲解：**
    因子溢价本质上是一个**时间序列的平均值**。如果 $\hat{\lambda}$ 显著大于 0，说明这个因子在过去能够提供超额收益。

---

### (2) 标准误与 t 统计量（显著性检验）

光看均值是不够的，如果收益波动极大，高均值可能只是因为运气好。所以需要计算 **t 值**。

**公式 (2.2) 标准误 (Standard Error)：**
$$\text{s.e.}(\hat{\lambda}) = \frac{\text{std}(\lambda_t)}{\sqrt{T}}$$

*   **符号含义：**
    *   $\text{std}(\lambda_t)$：因子收益率序列的标准差（波动程度）。
*   **公式讲解：**
    标准误衡量的是 " 均值估计 " 的精确度。波动越大，均值越不可信（标准误大）；数据期数越多，均值越可信（标准误小）。

**公式 (2.3) t 统计量：**
$$t\text{-值} = \frac{\hat{\lambda}}{\text{s.e.}(\hat{\lambda})}$$

*   **深度讲解：**
    *   **本质**：t 值衡量的是**" 信号 " 与 " 噪声 " 的比率**。分子是赚了多少，分母是波动的干扰。
    *   **判定标准**：如果 $|t| > 2.0$（在大样本下对应 P 值 < 0.05），我们才有信心说这个因子不是靠运气赚的钱。在因子投资研究中，这是判断因子是否存在的**第一道生死线**。

---

### (3) Spearman 秩相关系数（单调性检验）

一个好因子的表现应该是：指标越高，收益越高（或指标越低收益越高）。排序法将股票分成了 $L$ 组（如 10 组），我们需要检验这 10 个组的收益率是不是**排着队**上升或下降。

**公式 (2.4)：**
$$\rho_s = \frac{\text{cov}(X_r, X_g)}{\sigma_{X_r} \sigma_{X_g}}$$

*   **符号含义：**
    *   $X_g$：组号（1, 2, 3...10）。
    *   $X_r$：这 10 个组实际平均收益率的**排名**。
*   **深度讲解：**
    *   **为什么要用 " 秩（Rank）"？** 传统的 Pearson 相关系数衡量的是线性关系（是否在一条直线上），而 Spearman 衡量的是**<span style="color:rgb(195, 121, 251)">单调关系</span>**（只要是排着队的就行，不管距离）。
    *   **判定标准**：$\rho_s$ 越接近 1（正相关因子）或 -1（负相关因子），说明因子的逻辑越完美。如果 $t$ 值很高，但组别收益乱七八糟（不单调），说明因子可能被某些极端个股污染了，逻辑不可靠。

---

### (4) 多重排序中的收益计算（控制变量法）

为了排除干扰（例如：研究 " 价值 " 时想排除 " 市值 " 的影响），书中给出了**双重排序**的收益计算公式。

**公式 (2.7)：**
$$\lambda_{X_1 t} = \frac{1}{L_2} \sum_{i=1}^{L_2} (R_{Li, t} - R_{1i, t})$$

*   **符号含义：**
    *   $X_1$：我们要研究的目标因子。
    *   $X_2$：我们要排除的控制因子（假设分成了 $L_2$ 组）。
    *   $R_{Li, t}$：在控制因子第 $i$ 组里，目标因子表现最强的那组收益。
    *   $R_{1i, t}$：在控制因子第 $i$ 组里，目标因子表现最弱的那组收益。
*   **深度讲解（核心逻辑）：**
    这就是**" 剥离法 "**。
    1.  我们先把股票按 " 市值 " 分成 5 组。
    2.  在每一个市值组内部，算一下 " 高价值减去低价值 " 的收益。
    3.  最后把这 5 个收益取平均。
    *   **结果**：这样算出来的 $\lambda$ 就是**" 中性化 "**之后的因子收益。它表示：无论在大盘股还是小盘股里，这个因子都能赚到这么多钱。

---

### 📊 公式逻辑链条总结

1.  **构建**：先排序分组，计算各组收益及差值收益 $\lambda_t$。
2.  **求均值**：用 **$\hat{\lambda}$** 估计这个因子的超额收益能力。
3.  **看稳定性**：用 **t- 值** 排除运气因素，确保显著性（$|t|>2.0$）。
4.  **证逻辑**：用 **$\rho_s$** 确保收益是随指标单调变化的，没有 " 逻辑跳跃 "。
5.  **控污染**：用**双重排序求和公式**排除其他因子的干扰，证明该因子的**独立价值**。

---

## 5. 进阶方法：多重排序法 (Multiple Sorting)

为了排除其他因子的干扰（例如：排除市值对价值因子的影响），需要使用多重排序。

### (1) 独立双重排序 (Independent Double Sort)

*   **做法**：分别按因子 A（如市值）和因子 B（如 BM）独立进行 5 x 5 分组，取交集得到 25 个桶。
*   **优点**：地位对称，可以同时观察两个因子的效果。
*   **缺点**：如果两个因子相关性极高，会导致某些桶里的股票数量太少。

### (2) 条件双重排序 (Dependent/Conditional Double Sort)

*   **做法**：先按因子 A（控制变量）分 5 组；在每一组内部，再按因子 B（目标变量）分 5 组。
*   **意义**：这是考察**在控制了因子 A 之后，因子 B 是否还有增量信息**。

---

## 6. 核心局限性

*   **适用范围**：排序法仅适用于**风格因子**（Style Factors），难以处理宏观因子（如 GDP）。
*   **局限性**：排序法本质上比较“粗暴”，难以同时控制 3 个以上的因子。如果要精确控制多个风险暴露，后续需要用到**截面回归法**。

---

## 7. 因子命名约定 (书中的重要提醒)

书中建议以**变量代表的风格**来命名，而非变量名：

*   *错误示例*：BM 因子、ROE 因子。
*   *正确示例*：**价值因子**、**盈利因子**。
*   *原因*：业界通常用多个指标合成一个风格。

---

### 💡 总结建议

在实操中，排序法是**“第一步”**。它能帮你快速直观地看到：

1. 这个因子赚不赚钱（t 值）？
2. 收益是否稳定（累计曲线）？
3. 收益是否来自特定的小市值群体（等权 vs 市值加权对比）？

根据《因子投资：方法与实践》第二章第二节的内容，这一节是全书的**核心理论支柱**。如果说第一节的“排序法”是直观的工具，那么第二节的“回归检验”则是严谨的**裁判**，用来定量的判断：一个因子模型到底能不能解释市场。

以下是关于**“多因子模型的回归检验”**的完整笔记总结：

---

# 第二节：多因子模型的回归检验学习笔记

## 1. 核心逻辑：从截面角度看模型

回归检验的核心目标是回答：**不同资产之间的预期收益率差异，是否可以由它们在因子上的暴露（$\beta$）来解释？**

*   **理想状态**：预期收益率是因子暴露的线性函数，定价误差 $\alpha_i$ 应该全部为 0。
*   **现实状态**：$E[R_i^e] = \alpha_i + \boldsymbol{\beta}_i' \boldsymbol{\lambda}$。我们的目标是检验 $\alpha_i$ 是否显著偏离零。

---

## 2. 三大主流回归方法

本节详细介绍了三种检验多因子模型的方法，它们的侧重点各不相同：

### 方法一：时间序列回归 (Time-Series Regression)

**做法**：对每一个资产 $i$，用它的收益率序列对因子收益率序列做回归。
*   **公式 (2.13)**：$R_{it}^e = \alpha_i + \boldsymbol{\beta}_i' \boldsymbol{\lambda}_t + \varepsilon_{it}$
*   **核心输出**：
    1.  **截距项 $\alpha_i$**：即该资产的定价误差。
    2.  **斜率项 $\boldsymbol{\beta}_i$**：资产对因子的风险暴露。
*   **如何判别模型好坏？（GRS 检验）**：
    使用 **GRS 统计量 (公式 2.16)** 联合检验所有资产的 $\alpha_i$ 是否同时为 0。如果 GRS 检验被拒绝，说明该模型无法完全解释这些资产的收益。
*   **局限性**：要求因子收益率 $\boldsymbol{\lambda}_t$ 必须是已知的（如通过排序法得到的 SMB、HML），**无法处理宏观因子**（如 GDP）。

### 方法二：截面回归 (Cross-Sectional Regression)

**做法**：这是一个“两步走”方法（Two-pass Regression）。
1.  **第一步**：通过时序回归估算出每个资产的 $\beta$。
2.  **第二步**：在截面上，用资产收益率对第一步算出的 $\beta$ 做回归。
    *   **公式 (2.18)**：$E_T[R_i^e] = \boldsymbol{\beta}_i' \boldsymbol{\lambda} + \alpha_i$
*   **核心意义**：它不仅能求出因子收益率 $\lambda$，还能处理那些**无法直接交易的因子**（如通胀、工业产值）。
*   **重要修正（Shanken 修正）**：因为第二步回归用的解释变量 $\beta$ 是估计出来的，带有误差，所以计算标准误时必须进行 **Shanken 修正 (1992)**，否则会高估显著性。

### 方法三：Fama-MacBeth 回归 (业界标准)

这是量化实证研究中最常用、最重要的手段。

**做法**：

1.  **第一步**：同截面回归，先算出 $\beta$。
2.  **第二步**：在每一个时间点 $t$（比如每个月），都做一次截面回归，得到 $T$ 个因子的收益率估计值 $\hat{\lambda}_t$。
3.  **第三步**：对这 $T$ 个 $\hat{\lambda}_t$ 取平均值，并计算 t 检验。
*   **优点**：
    1.  能有效处理残差在截面上的相关性。
    2.  极其灵活，**允许 $\beta$ 随时间变化**（滚动窗口估计）。

---

## 3. 关键对比：时序回归 vs 截面回归

书中通过 **图 2.6** 展现了两者的微妙差异，这是理解模型评估的高级视角：

*   **时序回归的“霸道”之处**：它强制要求回归直线必须经过原点和因子模拟组合点。它衡量的是“因子本身赚不赚钱”。
*   **截面回归的“务实”之处**：它不强制经过原点，而是通过最小二乘法（OLS）寻找一条能让所有资产定价误差 $\alpha$ 的平方和最小的直线。
*   **背离现象**：如果一个因子的时序回归斜率为正，但截面回归斜率为负，说明这个因子可能存在严重问题（见图 2.7）。

---

## 4. 总结与方法论建议

1.  **没有完美的模型**：当资产数量足够多时，GRS 检验几乎总能拒绝任何模型。研究的重点不应是追求完美的 $\alpha=0$，而是看哪个模型解释能力更强。
2.  **资产需“打包”**：检验模型时，不建议直接用个股（噪声太大），而应将股票按某种属性（如市值、行业）“打包”成投资组合后再测试。
3.  **方法论价值**：学习这些回归方法的意义不在于计算本身，而在于通过比较不同方法的结论，加深对市场风险和收益驱动力的认知。

---

### 💡 核心术语卡片

*   **定价误差 ($\alpha$)**：模型解释不了的多余收益。
*   **GRS 检验**：判断一组 $\alpha$ 是否联合为零的“终极裁判”。
*   **Shanken 修正**：截面回归中为了补偿 $\beta$ 估计误差的必要数学手段。
*   **Two-pass Regression**：先求 $\beta$（时序），再求收益率（截面）的两步回归法。