---
notion-id: 30478d23-e296-80be-8038-d364ad9656de
base: "[[因子投资.base]]"
Last edited time: 2026-02-11T19:42:00
Tags: []
Verification: unverified
Owner:
  - 杰 吴
---
## 1. **AR 模型 (Autoregressive)：自回归模型**

- **核心思想**：今天的我取决于昨天的我。它用变量自身的历史数据来预测未来。
- **实现原理**：将当前时刻的值看作过去 $p$ 个时刻值的线性组合加上一个随机噪声。
- **数学公式**：$Y_t=c+ϕ_1Y_{t−1}+ϕ_2Y_{t−2}+⋯+ϕ_pY_{t−p}+ϵ_t$
    - $p$：阶数，表示考虑过去多少期数据。
    - $ϕ$：回归系数。
    - $ϵ_t$：白噪声（随机误差）。
- **识别特征**：**偏自相关函数 (PACF)  **$p$ **阶截尾**（即在 $p$ 步后迅速降为 0），自相关函数 (ACF) 拖尾。

## **2. MA 模型 (Moving Average)：移动平均模型**

- **核心思想**：今天的我取决于过去的“意外”（误差）。它利用过去 $q$ 个时期的预测误差来修正当前值。
- **实现原理**：关注的是误差项的累加。它能有效地消除随机波动，捕捉短期的震荡。
- **数学公式**：$Y_t=μ+ϵ_t+θ_1ϵ_{t−1}+θ_2ϵ_{t−2}+⋯+θ_qϵ_{t−q}$
    - $μ$：均值。建模前会对数据中心化，新序列 = 旧序列 - $μ$，$μ$ 就变为 0 了。
    - $q$：阶数。
    - $θ$：移动平均系数。
- **识别特征**：**自相关函数 (ACF) **$q$** 阶截尾**，偏自相关函数 (PACF) 拖尾。

## **3. ARMA 模型：自回归移动平均模型**

- **核心思想**：AR + MA 的合体。既考虑历史观测值，也考虑历史误差。
- **实现原理**：用更少的参数来描述复杂的平稳时间序列。
- **适用条件**：**数据必须是平稳的**（即均值、方差不随时间显著变化）。
- 数学公式：$Y_t=c+ϵ_t+∑_{i=1}^{p}ϕ_iY_{t−i}+∑_{j=1}^{q}θ_jϵ_{t−j}$。
- **识别特征**：ACF 和 PACF 均为**拖尾**（不直接截尾，呈指数衰减）。

## **4. ARIMA 模型：差分自回归移动平均模型**

- **核心思想**：ARMA + 差分（Integration）。
- **实现原理**：现实中大部分数据是不平稳的（如股票、气温有明显趋势）。ARIMA 通过**差分**（用后一天减去前一天）**将非平稳数据转为平稳数据，再套用 ARMA 模型****。**
- **三个核心参数 **$(p,d,q)$** ：**
    - $p$** (AR项)**：自回归阶数。
    - $d$ **(I项)**：**差分次数**（通常 1 或 2 阶就能让数据平稳）。
    - $q$** (MA项)**：移动平均阶数。
- **数学表达**：对 $d$ 阶差分后的序列 $Y_t^′$ 进行 ARMA 建模。

## **“中心化” & ”差分去趋势“**

### 中心化 **Centering**

- 在做 **线性回归、PCA（主成分分析）、神经网络** 时，通常都要做这一步。
- **目的：** 为了让模型只关注 “变量之间的相关性”，而不是被巨大的绝对数值干扰。
- 适用模型：AR、MA、ARMA
- 适用数据：**平稳数据**

### 差分去趋势

- 差分后的序列，**均值不一定是 0**。
    - **如果差分后序列均值是 0：说明原数据只是乱跳，没有固定涨幅。**
    - 如果差分后序列均值是 **常数**$c$：说明原数据有一个**稳定的 “漂移（Drift）”**（比如每天固定涨 $c$ 块钱）。这个“常数”就是原数据的**平均斜率。****建模时会加上这个常数项。**
    - 如果你预测未来，带 Drift 的模型会沿着这个斜率一直往上涨/跌；不带 Drift 的模型预测到最后会变成一条平平的直线。
- 适用模型：ARIMA
- 适用数据：**不平稳**数据

### Versus

| **处理方式** | **核心动作** | **针对模型** | **解决的问题** | **物理意义** |
| --- | --- | --- | --- | --- |
| **中心化** | $Y−mean$ | AR / MA / ARMA | 消除“海拔高度” | **把波动中心对齐到 0** |
| **差分** | $Y_t−Y_{t−1}$ | ARIMA ($d≥1$) | 消除“整体趋势” | **把“斜坡”放平** |
| **漂移项** | 差分后再处理均值 | ARIMA 的常数项 | **捕捉“固定涨/跌幅”** | 即使放平了，也是个有高度的平面 |

## **实现流程：Box-Jenkins 方法论**

> 先平稳，再看图，后定型。

```python
1. 数据预处理
   ├─ 检查数据质量（缺失值、异常值）
   ├─ 计算收益率（对数收益率）
   └─ 可视化时间序列

2. 平稳性检验
   ├─ 绘制时间序列图（观察趋势）
   ├─ ADF 检验（单位根检验）
   └─ 如不平稳，进行差分或其他变换

3. 模型识别
   ├─ 绘制 ACF 和 PACF 图
   ├─ 根据截尾/拖尾模式初步确定 (p, q)
   └─ 确定候选模型列表

4. 参数估计
   ├─ 使用最大似然估计拟合模型
   ├─ 比较不同模型的 AIC/BIC
   └─ 选择信息准则最优的模型

5. 模型诊断
   ├─ 残差序列应为白噪声
   ├─ 残差 ACF 无显著相关
   ├─ Ljung-Box 检验（p > 0.05）
   └─ 残差正态性检验（Q-Q 图）

6. 模型应用
   ├─ 预测未来值
   ├─ 计算置信区间
   └─ 与实际值比较评估
```

### **第一步：平稳性检验 (Stationarity Check)**

- **原理**：模型要求数据是弱平稳的。
- **操作**：
    - 看图：数据是否有明显的上升/下降趋势？
    - 单位根检验 (ADF Test)：如果$p−value>0.05$，说明不平稳。
- **对策**：不平稳则进行**差分**（Difference），直到平稳，确定参数 $d$。

### **第二步：模型识别 (Model Identification)**

- **原理**：通过观察 ACF 和 PACF 图来初步判断 $p$ 和 $q$。

![[image 12.png]]

**情况 A：PACF 截尾 **$→$** 选 AR(p)**

- **现象：** PACF 在第 $p$ 根柱子后突然消失，而 ACF 是一点点衰减（拖尾）。
- **理解：** 这说明今天的数值只受过去 $p$ 天的 “直接影响”。
- **例子：** PACF 在第 2 阶后断崖式下跌，那就定为 **AR(2)**。

**情况 B：ACF 截尾 **$→$** 选 MA(q)**

- **现象：** ACF 在第$q$ 根柱子后突然消失，而 PACF 是缓慢衰减（拖尾）。
- **理解：** 这说明今天的数值只受过去 $q$ 天的 “随机误差” 影响。
- **例子：** ACF 在第 1 阶后断崖下跌，那就定为 **MA(1)**。

**情况 C：两个都“拖尾” **$→$** 选 ARMA(p, q)**

- **现象：** 两张图都没有明显的“断崖”，都是慢慢地、像滑梯一样滑向 0。
- **理解：** 这种规律最复杂，既有历史值的惯性，又有误差的修正。
- **操作：** 此时肉眼很难看出准确的 $p$ 和 $q$，所以进入第三步** “试错环节”。**

### **第三步：参数选择 (Model Selection)**

![[image 13.png]]

- **准则**：为了防止过拟合，我们追求 “模型越简单越好，误差越小越好”。
- **指标**：**AIC** (Akaike Information Criterion) 或 **BIC**。值越小，模型越优。
- **自动化**：在 Python 中常用 auto_arima 函数自动遍历寻找最优的 $(p,d,q)$。

### **第四步：残差检验 (Residual Diagnosis)**

![[image 14.png]]

- **看模型留下的 “垃圾” 是不是纯粹的随机噪音；****如果垃圾里还有规律（不正态）****，就说明模型还没修好。**
- **操作**：检查残差的 ACF 图，如果所有滞后项都在置信区间内，说明模型合格。
- **原理**：**如果模型提取了所有规律，剩下的残差应该是白噪声**（纯随机，无规律）。
    - **均值为 0**（没有偏差）。
    - **方差恒定**（波动稳定）。
    - **相互独立**（没有未被捕捉的规律）。
    - **符合正态分布（高斯分布）**。
- **核心逻辑：**
    - 如果残差符合正态分布（那个漂亮的钟形曲线），说明剩下的全是**纯粹的随机干扰**。
    - 如果残差不符合正态分布（比如歪了、或者有极端值），说明你的模型**还没学透**，数据里还藏着一些有用的规律（比如非线性特征或异常点）被你当成垃圾给扔了。
- **如何检验？（三个判官)**
    - **直方图 (Histogram)**
![[image 15.png]]
        - **理想状态：**像个对称的铃铛（中间高，两边低）。
    - **Q-Q 图 (Quantile-Quantile Plot) **
![[image 16.png]]
        - **看什么：** 散点是否分布在一条 45 度的直线上。
        - **理想状态：** 所有点都紧紧贴在那条斜线上。
        - **异常信号：** 如果**两头翘起来或垂下去**，说明数据有 **“厚尾”（有很多极端值）**。
    - **JB 检验 (Jarque-Bera Test) —— 数值标准**
        - 这是专门针对正态性的统计检验
        - $H0$**（原假设）：**残差符合正态分布。
        - $H1$**（备择假设）：**残差不符合正态分布。
        - $P>0.05$：恭喜！接受原假设，**符合正态性**。
        - $P<0.05$：没通过，**不符合正态性**。

### **如果残差不正态，怎么办？**

1. **有异常值（Outliers）：** 数据里有几个极其离谱的点，把曲线拽歪了。
    - *对策：* 检查原始数据，剔除或特殊处理异常值。
2. **方差不齐（异方差）：** 数据波动越来越大。
    - *对策：* 建模前对原始数据做 **对数处理 (Log Transformation)**。
3. **模型没选对：** ARIMA 是线性模型，如果数据有很强的非线性（比如波动剧烈的股市）。
    - *对策：* 考虑换 **GARCH** 模型（专门处理波动性不均匀的情况）。