简单来说：**它们不是同一个东西，但有着“父子”或者“包含”的关系。**

**GLS（广义最小二乘法）** 是一个更大的范畴，而 **WLS（加权最小二乘法）** 是 GLS 的一种**特殊情况**。

## 1. 核心区别：它们处理什么样的“病”？

在回归分析中，如果残差项 $\epsilon$ 不满足“独立同分布”（IID）的理想状态，我们就要动用这两个工具：

*   **WLS（加权最小二乘法）**：
    *   **专门对付：异方差（Heteroscedasticity）**。
    *   **场景**：有些股票波动大，有些波动小，但你认为股票之间是**相互独立**的（比如 A 跌不代表 B 也要跌）。
    *   **数学特征**：它的残差协方差矩阵是一个**对角阵**（只有对角线上有数字，代表各股方差；其他地方全是 0，代表互不相关）。

*   **GLS（广义最小二乘法）**：
    *   **对付：异方差 + 自相关/截面相关（Autocorrelation / Correlation）**。
    *   **场景**：不仅波动大小不同，而且股票之间还**存在勾连**（比如同一行业的股票残差往往一起动）。
    *   **数学特征**：它的残差协方差矩阵是一个**全矩阵**（对角线和非对角线都有数字）。

---

## 2. 包含关系（数学表达）

在 GLS 的框架下，我们需要用到权重矩阵 $\boldsymbol{\Sigma}$：

*   如果 $\boldsymbol{\Sigma}$ 是**对角矩阵**（只有对角线上有不同的权重），那么 **GLS 就变成了 WLS**。
*   如果 $\boldsymbol{\Sigma}$ 是**单位矩阵**（对角线全是 1，其他全是 0），那么 **GLS 就变成了 OLS**。

**结论：GLS 是最顶层的概念，WLS 是去掉了“相关性”后的简化版 GLS。**

---

## 3. 在《因子投资》中的实战应用

这是你最需要关注的地方：**为什么书里有时提 WLS，有时提 GLS？**

### ① Barra 模型为什么用 WLS？（见 7.2 节）

Barra 在计算因子收益率 $\lambda$ 时，通常使用 **WLS**。

*   **做法**：给大盘股更高的权重（通常是市值平方根），给小盘股低权重。
*   **理由**：Barra 假设在控制了国家、行业和风格因子后，股票的特质残差是**相互独立**的。它只担心小盘股噪声大（异方差），不担心残差相关性，所以用 WLS 就够了，计算速度也快。

### ② 截面回归为什么提 GLS？（见 2.2 节）

在评价多因子模型效果时，学术界倾向于提 **GLS**。

*   **理由**：学术研究追求极端严谨。他们认为股票之间即使剔除了因子，残差可能还是相关的。使用 GLS 可以利用 $\boldsymbol{\Sigma}^{-1}$ 对数据进行“彻底净化”，得出的因子溢价 $\lambda$ 在统计上是最有效的（误差最小）。

---

## 4. 形象比喻：批改试卷

*   **OLS (普通版)**：老师批改 100 个学生的卷子，认为每个人都是独立完成的，且每个人的粗心程度一样，所以平均打分。
*   **WLS (加权版)**：老师发现有些学生（小盘股）发挥不稳定，容易乱写；有些学生（大盘股）很稳健。老师决定给稳健学生的答案**更高的信任权重**。但老师仍认为大家是独立考试。
*   **GLS (广义版)**：老师不仅发现学生发挥不稳定，还发现同桌之间**互相抄袭**（截面相关）。老师不仅调整权重，还通过数学手段**剔除了“抄袭”带来的重复信息**。

---

## 💡 总结笔记卡片

| 特性         | OLS       | WLS                 | GLS              |
| :--------- | :-------- | :------------------ | :--------------- |
| **残差方差**   | 相等        | **不相等**             | **不相等**          |
| **残差相关性**  | 无相关       | 无相关                 | **有相关**          |
| **权重矩阵形状** | 单位阵 ($I$) | 对角阵                 | 全矩阵              |
| **主要用途**   | 基础回归      | **Barra 模型** (市值加权) | **严谨的模型检验** (降噪) |

**一句话总结：**

WLS 是只管“贫富差距”（方差大小）的 GLS；而真正的 GLS 既要管“贫富差距”，还要管“裙带关系”（截面相关）。