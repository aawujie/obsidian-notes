这是一份针对《因子投资：方法与实践》**第 2.5 章节（多因子模型比较）**的完整深度笔记。本笔记整合了复杂的矩阵公式、几何图解逻辑以及书中的实证案例。

---

# 📖 第 2.5 章：多因子模型比较 (笔记大合集)

**核心目标**：当学术界提出各种模型（如 FF 3、FF 5、q-factor）时，我们需要一个标准的统计标尺来判定：**哪个模型更能解释资产的预期收益？新加入的因子是否真的有增量贡献？**

---

## 1. GRS 检验：切点组合的对决

GRS 检验（Gibbons, Ross, Shanken 1989）是检验模型**整体定价能力**的终极裁判，主要用于时序回归。

### (1) 矩阵形式 (公式 2.16)
$$GRS = \left( \frac{T - N - K}{N} \right) \left( 1 + \bar{\boldsymbol{\lambda}}' \hat{\boldsymbol{\Sigma}}_f^{-1} \bar{\boldsymbol{\lambda}} \right)^{-1} \hat{\boldsymbol{\alpha}}' \hat{\boldsymbol{\Sigma}}^{-1} \hat{\boldsymbol{\alpha}} \sim F(N, T - N - K)$$
*   **$N$**: 测试资产个数；**$K$**: 因子个数；**$T$**: 样本期数。
*   **$\hat{\boldsymbol{\alpha}}$**: $N$ 个资产的定价误差（截距项）向量。
*   **$\hat{\boldsymbol{\Sigma}}$**: 残差协方差矩阵。
*   **$\bar{\boldsymbol{\lambda}}$ / $\hat{\boldsymbol{\Sigma}}_f$**: 因子的均值和协方差矩阵。

### (2) 几何形式 (公式 2.68 - 灵魂公式)
书中给出了一个极其直观的表达方式：
$$GRS = \frac{T - N - K}{N} \cdot \left( \frac{1 + \hat{\theta}_{N+K}^2}{1 + \hat{\theta}_K^2} - 1 \right)$$
*   **$\hat{\theta}_K$**: 仅使用旧因子（$K$ 个）能达到的**最大夏普比率**。
*   **$\hat{\theta}_{N+K}$**: 加入 $N$ 个资产后，能构建出的**新最大夏普比率**。
*   **几何意义（图 2.11）**：在风险 $\sigma=1$ 的垂直线上，旧切线高度为 $OA$，新切线高度为 $OB$。GRS 就在测 **$OB$ 是不是显著比 $OA$ 长**。如果夏普比率显著提升，说明原模型被拒绝。

---

## 2. 均值—方差张成 (Spanning) 检验

与 GRS 假设存在无风险利率 $R_f$ 不同，张成检验关注的是**整条有效前沿曲线（抛物线）是否移动**。

### (1) 核心逻辑与原假设 (公式 2.71)
研究新资产 $R_2$ 能否被旧因子 $R_1$ “张成”（即完美替代）。
$$R_{2t} = \alpha + \beta R_{1t} + \varepsilon_t$$
*   **原假设 $H_0$**: $\alpha = 0, \delta = 0$ (其中 $\delta = \mathbf{1} - \beta \mathbf{1}$)。
*   **含义**：
    1.  $\alpha=0$：新资产没有超额收益（不产生垂直位移）。
    2.  $\delta=0$：风险暴露之和为 1（不改变前沿形状）。

### (2) 三大统计量的几何表达 (公式 2.78-2.80 & 图 2.12)
书中利用 **图 2.12 中的 6 根线段**（$OA, OB, OC, OD, AG, AH, BE, BF$）量化了曲线的位移：

*   **似然比检验 (LR)**：
    $$LR = \frac{T-K-N}{N} \left[ \left(\frac{OD}{OC}\right) \left(\frac{AH}{BF}\right) - 1 \right]$$
    *   **左端位移 ($OD/OC$)**：比较全局最小方差组合的风险。
    *   **右端位移 ($AH/BF$)**：比较渐近线（高收益端）的夏普比。

*   **Wald 检验** (向外扩张)：
    $$W = s_1 + s_2 = \left(\frac{OD}{OC}\right)^2 - 1 + \left(\frac{BE}{BF}\right)^2 - 1$$

*   **拉格朗日乘数 (LM)** (向内收缩)：
    $$LM = \frac{s_1}{1+s_1} + \frac{s_2}{1+s_2} = 1 - \left(\frac{OC}{OD}\right)^2 + 1 - \left(\frac{AG}{AH}\right)^2$$

**💡 核心洞察**：Wald 和 LM 具有**完美对称性**。Wald 看“增加新因子收益提升了多少”，LM 看“去掉新因子收益降低了多少”。

---

## 3. $\alpha$ 检验 (最通俗的办法)

如果觉得 GRS 的矩阵运算太复杂，业界常用 $\alpha$ 检验来作为辅助支撑。

### (1) 评价指标
1.  **Avg. $|\alpha_i|$**：所有测试资产定价误差绝对值的平均。越小越好。
2.  **Avg. $|t\text{-值}|$**：所有资产 $t$ 统计量绝对值的平均。
3.  **#($|t| \ge 2.0$)**：显著无法被解释的异象个数。

### (2) 实务启示
书中通过实证显示（表 4.7），有些模型虽然 GRS 被拒绝了，但它的 **Avg. $|\alpha|$** 非常低，说明模型虽然不完美，但在实战中已经非常管用了。

---

## 4. 贝叶斯方法 (进阶视角)

Barillas 和 Shanken (2018) 提出，比较模型不应该看它解释别人，而应该看它**包含的因子本身。**

### (1) 核心公式 (2.82)
$$\frac{prob(M_i | D)}{prob(M_j | D)} = \frac{prob(M_i)}{prob(M_j)} \cdot \frac{prob(D | M_i)}{prob(D | M_j)}$$
*   **贝叶斯因子 (Bayes Factor)**：通过计算**边际似然度**之比来判定哪个模型更优。
*   **结论**：在贝叶斯框架下，模型的优劣仅取决于它们所包含因子的夏普比率。

---

## 5. 总结：如何选择检验方法？

| 场景 | 推荐方法 | 判定逻辑 |
| :--- | :--- | :--- |
| **假设有无风险利率 $R_f$** | **GRS 检验** | 比较切点（夏普比率）的提升。 |
| **不假设 $R_f$ (更全面)** | **Spanning 检验** | 比较整条有效前沿抛物线的位移。 |
| **多模型两两对决** | **$\alpha$ 检验汇总** | 统计有多少个异象被模型解释掉了。 |
| **排除运气干扰** | **贝叶斯方法** | 计算模型为真的后验概率。 |

---

### 💡 最终复习技巧
1.  **看 GRS**：盯着 **夏普比率的平方差**。
2.  **看 Spanning**：盯着 **$OD/OC$** (左端点) 和 **$AH/BF$** (右端点)。
3.  **记逻辑**：如果旧因子能通过组合模拟出新资产，那么新资产就被“张成”了，没有独立价值。